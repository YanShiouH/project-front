import{T as O,x as r,ag as S,Y as D,Z as I,$ as H,c as t,a1 as l,aF as Y,S as Z,af as G,K as h,a8 as y,au as T,b1 as J,V as Q,a0 as W,a2 as X,a3 as o,at as ee,ay as ae,az as te,ae as le,aA as oe,aD as se,aa as re,an as ne,R as ue}from"./index-2464dbc7.js";import{c as ie,a as M,f as de,u as me,d as _}from"./index.esm-2f23a872.js";import{V as ce}from"./VContainer-74dc93a4.js";import{a as pe,V as $}from"./VRow-95f717ca.js";import{V as ge}from"./VForm-ea6f9526.js";import{V as ve}from"./VTextarea-2f937a55.js";import{V as be}from"./VCheckbox-4a07be00.js";import"./_commonjsHelpers-725317a4.js";const fe=ne("h1",{class:"text-center"},"Culture Corner",-1),Be={__name:"CultureCorner",setup(Ve){const c=O(),k=r(5),p=r([{key:"title",order:"asc"}]),g=r(1),C=r([]),q=[{title:"Image",align:"center",sortable:!1,key:"image"},{title:"Title",align:"center",sortable:!0,key:"title"},{title:"Content",align:"center",sortable:!0,key:"content"},{title:"Date",align:"center",sortable:!0,key:"date"},{title:"Likes",align:"center",sortable:!0,key:"likes.length"},{title:"Publish",align:"center",sortable:!0,key:"publish"},{title:"Edit",align:"center",sortable:!1,key:"edit"}],w=r(!1),P=r(0),v=r(""),B=()=>{g.value=1,n()},n=async()=>{var s,e;w.value=!0;try{const{data:i}=await S.get("/culture/all",{params:{page:g.value,itemsPerPage:k.value,sortBy:((s=p.value[0])==null?void 0:s.key)||"title",sortOrder:((e=p.value[0])==null?void 0:e.order)||"asc",search:v.value}});C.value.splice(0,C.value.length,...i.result.data),P.value=i.result.count}catch(i){c({text:i.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}w.value=!1};n();const E=s=>{u.value=s._id,b.value.value=s.title,f.value.value=s.content,V.value.value=s.publish,d.value=!0},d=r(!1),u=r(""),K=()=>{u.value="",d.value=!0},A=()=>{d.value=!1,z(),U.value.deleteFileRecord()},L=ie({title:M().required("Title is required"),content:M().required("Content is required"),publish:de()}),{handleSubmit:N,isSubmitting:x,resetForm:z}=me({validationSchema:L,initialValues:{title:"",content:"",publish:!1}}),b=_("title"),f=_("content"),V=_("publish"),m=r([]),F=r([]),U=r(null),R=N(async s=>{if(!(u.value.length===0&&m.value.length===0))try{const e=new FormData;e.append("title",s.title),e.append("content",s.content),e.append("date",new Date().toISOString()),e.append("publish",s.publish),m.value.length>0&&e.append("image",m.value[0].file),u.value.length>0?(await S.patch("/culture/"+u.value,e),c({text:"Updated Successfully",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})):(await S.post("/culture",e),c({text:"Added Successfully",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})),A(),n()}catch(e){c({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(s,e)=>{const i=D("v-data-table-server"),j=D("vue-file-agent");return I(),H(Z,null,[t(ce,null,{default:l(()=>[t(pe,null,{default:l(()=>[t($,{cols:"12"},{default:l(()=>[fe]),_:1}),t(G),t($,{cols:"12"},{default:l(()=>[t(h,{color:"green",onClick:K},{default:l(()=>[y("Add Article")]),_:1}),t(i,{"items-per-page":k.value,"onUpdate:itemsPerPage":[e[1]||(e[1]=a=>k.value=a),n],"sort-by":p.value,"onUpdate:sortBy":[e[2]||(e[2]=a=>p.value=a),n],page:g.value,"onUpdate:page":[e[3]||(e[3]=a=>g.value=a),n],items:C.value,headers:q,loading:w.value,"items-length":P.value,search:v.value,hover:""},{top:l(()=>[t(T,{label:"Search","append-icon":"mdi-magnify","onClick:append":B,onKeydown:J(B,["enter"]),modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a)},null,8,["onKeydown","modelValue"])]),"item.image":l(({item:a})=>[t(Q,{src:a.raw.image,height:"50px"},null,8,["src"])]),"item.publish":l(({item:a})=>[a.raw.publish?(I(),W(ue,{key:0,icon:"mdi-check"})):X("",!0)]),"item.edit":l(({item:a})=>[t(h,{icon:"mdi-pencil",onClick:he=>E(a.raw),variant:"text"},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(Y,{persistent:"",modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=a=>d.value=a),width:"500px"},{default:l(()=>[t(ge,{disabled:o(x),onSubmit:ee(o(R),["prevent"])},{default:l(()=>[t(ae,null,{default:l(()=>[t(te,null,{default:l(()=>[y(le(u.value.length>0?"Edit Article":"Add Article"),1)]),_:1}),t(oe,null,{default:l(()=>[t(T,{label:"Title",modelValue:o(b).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>o(b).value.value=a),"error-messages":o(b).errorMessage.value},null,8,["modelValue","error-messages"]),t(ve,{label:"Content",modelValue:o(f).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>o(f).value.value=a),"error-messages":o(f).errorMessage.value,rows:"12"},null,8,["modelValue","error-messages"]),t(be,{label:"Publish",modelValue:o(V).value.value,"onUpdate:modelValue":e[6]||(e[6]=a=>o(V).value.value=a),"error-messages":o(V).errorMessage.value},null,8,["modelValue","error-messages"]),t(j,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=a=>m.value=a),"raw-model-value":F.value,"onUpdate:rawModelValue":e[8]||(e[8]=a=>F.value=a),"max-files":1,"max-size":"1MB",accept:"image/jpg,image/jpeg,image/png",multiple:!1,"error-text":{type:"Invalid file format",size:"File is too large"},deletable:"",ref_key:"fileAgent",ref:U},null,8,["modelValue","raw-model-value"])]),_:1}),t(se,null,{default:l(()=>[t(re),t(h,{color:"red",onClick:A,loading:o(x)},{default:l(()=>[y("Cancel")]),_:1},8,["loading"]),t(h,{color:"green",type:"submit",loading:o(x)},{default:l(()=>[y("Submit")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{Be as default};
